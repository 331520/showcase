<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pe="http://primefaces.org/ui/extensions">
<ui:composition template="/templates/showcaseLayout.xhtml">
    <ui:define name="centerContent">
        <f:facet name="header">
            <h:outputText value="MasterDetail"/>
        </f:facet>
        <h:panelGroup layout="block" styleClass="centerContent">
            Complex master-detail views with CRUD operations and a server-side flow listener.
            SelectLevelEvent passing into the flow listener and its return value allow to control the level to be navigated.
            If save of the detail view (level 2) was e.g. successful, the next level to go should be the master view (level 1).
            Otherwise, in case of some errors, user should stay on the detail view.
        </h:panelGroup>

        <h:panelGroup layout="block" styleClass="centerExample">
            <pe:masterDetail id="masterDetail" selectLevelListener="#{selectLevelListener.handleNavigation}">
                <f:facet name="header">
                    <pe:messages showDetail="false" showSummary="true"/>
                </f:facet>

                <pe:masterDetailLevel level="1">
                    <f:facet name="label">
                        <h:outputFormat value="Overview {0}">
                            <f:param value="Persons"/>
                        </h:outputFormat>
                    </f:facet>

                    <p:dataTable id="persons" value="#{complexMasterDetailController.persons}" var="person">
                        <p:column headerText="Name">
                            <p:commandLink value="#{person.name}">
                                <pe:selectDetailLevel contextValue="#{person}"/>
                            </p:commandLink>
                        </p:column>
                        <p:column headerText="Tax Class">
                            <h:outputText value="#{person.taxClass}"/>
                        </p:column>
                        <p:column headerText="Birth Date">
                            <h:outputText value="#{person.birthDate}">
                                <f:convertDateTime pattern="dd.MM.yyyy"/>
                            </h:outputText>
                        </p:column>
                    </p:dataTable>
                </pe:masterDetailLevel>

                <pe:masterDetailLevel level="2" contextVar="person" levelLabel="Person Detail">
                    <h:panelGrid id="personDetail" columns="2" columnClasses="formColumn1,formColumn2">
                        <h:outputText value="Name (string)"/>
                        <p:inputText value="#{person.name}" required="true" label="Name"/>
                        <h:outputText value="Tax Class (number)"/>
                        <p:inputText value="#{person.taxClass}" required="true" label="Tax Class">
                            <f:validateLength maximum="1"/>
                        </p:inputText>
                        <h:outputText value="Birth Date (date dd.MM.yyyy)"/>
                        <p:inputText value="#{person.birthDate}" required="true" label="Birth Date">
                            <f:convertDateTime pattern="dd.MM.yyyy"/>
                        </p:inputText>
                        <h:outputText value="Language skills"/>
                        <h:panelGrid columns="2" style="vertical-align: middle;">
                            <p:dataList value="#{complexMasterDetailController.selectedLanguageSkills}"
                                        var="skill" itemType="circle">
                                <h:outputText value="#{skill}"/>
                            </p:dataList>
                            <p:commandLink process="@this" style="padding:5px 0 0 8px; vertical-align:middle;">
                                <h:graphicImage library="images" name="flashlight_plus.png"/>
                                <pe:selectDetailLevel step="1"/>
                                <pe:tooltip value="Add language skills"/>
                            </p:commandLink>
                        </h:panelGrid>
                    </h:panelGrid>

                    <p:commandButton value="Save with success" action="#{complexMasterDetailController.saveSuccess(person)}"
                                     style="margin-top: 10px;" icon="ui-icon-disk">
                        <pe:selectDetailLevel level="1"/>
                    </p:commandButton>
                    <p:commandButton value="Save with failure" action="#{complexMasterDetailController.saveFailure(person)}"
                                     style="margin-top: 10px;" icon="ui-icon-disk">
                        <pe:selectDetailLevel level="1"/>
                    </p:commandButton>
                    <p:commandButton type="button" value="Delete" onclick="deletedDlg.show()" style="margin-top: 10px;"/>

                    <p:dialog header="Delete confirmation" widgetVar="deletedDlg" resizable="false"
                              modal="true" appendToBody="true">
                        <h:panelGroup layout="block" style="padding: 5px;">
                            <h:outputText value="Are you sure you want to delete this person?"/>
                        </h:panelGroup>
                        <p:commandButton value="Delete" oncomplete="deletedDlg.hide();"
                                         action="#{complexMasterDetailController.delete(person)}"
                                         style="margin-top: 10px;">
                            <pe:selectDetailLevel level="1"/>
                        </p:commandButton>
                        <p:commandButton value="Cancel" type="button" onclick="deletedDlg.hide();"
                                         style="margin-top: 10px;"/>
                    </p:dialog>
                </pe:masterDetailLevel>

                <pe:masterDetailLevel level="3" levelLabel="Language skills">
                    <h:panelGrid columns="2" columnClasses="formColumn1,formColumn2">
                        <h:outputText value="Choose language skill"/>
                        <p:selectOneMenu value="#{complexMasterDetailController.languageSkillToAdd}" style="width: 200px;">
                            <f:selectItems value="#{complexMasterDetailController.availableLanguageSkills}"/>
                        </p:selectOneMenu>
                    </h:panelGrid>
                    <p:commandButton value="Add" action="#{complexMasterDetailController.addLanguageSkill}"
                                     style="margin-top: 10px;" icon="ui-icon-plusthick">
                        <pe:selectDetailLevel step="-1"/>
                    </p:commandButton>
                </pe:masterDetailLevel>
            </pe:masterDetail>
        </h:panelGroup>

        <ui:decorate template="/templates/threeTabsDecoratorModel.html">
            <ui:define name="contentTab1">
                contentTab1
            </ui:define>
            <ui:define name="contentTab2">
                contentTab2
            </ui:define>
            <ui:define name="contentTab3">
                contentTab3
            </ui:define>
        </ui:decorate>
    </ui:define>
    <ui:define name="useCases">
        <ui:include src="/sections/masterDetail/useCasesChoice.xhtml"/>
    </ui:define>
    <ui:define name="docuTable">
        <ui:include src="/sections/shared/threeTabsDocumentation.xhtml">
            <ui:param name="tagName1" value="masterDetail"/>
            <ui:param name="tagName2" value="masterDetailLevel"/>
            <ui:param name="tagName3" value="selectDetailLevel"/>
        </ui:include>
    </ui:define>
</ui:composition>
</html>
